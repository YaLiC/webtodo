jQuery.fn.PosInCenter = function() { 	this.css('position','absolute'); 	this.css('top', (($(window).height() - this.outerHeight()) / 2) + $(window).scrollTop() + 'px'); 	this.css('left', (($(window).width() - this.outerWidth()) / 2) + $(window).scrollLeft() + 'px'); 	return this; }﻿jQuery.fn.UpdateInfo = function(){$('#wtdinfo').fadeOut('fast').load('core.php?ajax=wtdinfo').fadeIn('middle');};jQuery.fn.UpdateToday = function(){$('#today').fadeOut('fast').load('core.php?ajax=todayinfo').fadeIn('middle');};﻿jQuery.fn.GetContent = function(){	$('#main').hide().load('core.php?ajax=script&action=view&value=std').fadeIn('middle'); $().UpdateInfo(); $().UpdateToday();};var search_timeout = null;﻿jQuery.fn.initSearch = function(){clearTimeout(search_timeout); search_timeout = setTimeout('$().searchToDo()',800);};﻿jQuery.fn.searchToDo = function(){	var searchString = $('#findbox').val();	if (searchString.length > 2) {		$.ajax({			type:'post',	cache:true,	url:'core.php',	data:'action=search&find='+ searchString,			success: function(html) {$('#main').html(html);}		});	}	if (searchString.length == 0) {$().GetContent();}};jQuery.fn.CheckStat = function(){	if ($('#statistic').data('all') == 0) {		noty({		text: 'У вас нет ни одной задачи!..<br/>Создать новую?', 		buttons: [			{type:'button green', text:'Да, создать', click:function($noty) {$noty.close(); $('#todocreate').trigger('click');}},			{type:'button blue', text:'Нет, позже', click:function($noty) {$noty.close();}}		],		closable:false, layout:'bottomRight', type:'information', timeout:false		});	};	if (localStorage.getItem('newtodotext')) {		noty({		text: 'Обнаружена ещё несохраннёная задача.<br/>Показать её в поле ввода новой задачи?', 		buttons: [			{type:'button green', text:'Да', click: function($noty) {$noty.close();				$('#todocreate').trigger('click'); $('#newtodotext').attr('value', localStorage.getItem('newtodotext'));}},			{type:'button blue', text:'Позже', click: function($noty) {$noty.close();}},			{type:'button red', text:'Забыть', click: function($noty) {$noty.close(); localStorage.removeItem('newtodotext');}}		],		closable:false, layout:'bottomRight', type:'information', timeout:false		});	};	if (localStorage.getItem('edittodotext')) {		noty({		text: 'Обнаружена изменённая,<br/>но ещё несохраннёная задача.<br/>Отобразить её?', 		buttons: [			{type:'button green', text:'Да', click:function($noty) {$noty.close();				noty({text:localStorage.getItem('edittodotext')+'<br/>',					buttons: [						{type:'button red', text:'Забыть!', click: function($noty) {$noty.close();localStorage.removeItem('edittodotext');}},						{type:'button blue', text:'Хранить в памяти', click: function($noty) {$noty.close();}}					],					closable: false, layout:'center', timeout:false				});			}},			{type:'button blue', text:'Позже', click:function($noty) {$noty.close();}},			{type:'button red', text:'Забыть', click:function($noty) {$noty.close(); localStorage.removeItem('edittodotext');}}		],		closable:false, layout:'bottomRight', type:'information', timeout:false		});	};};jQuery(document).ready(function($) {$(document).ajaxError(function(){noty({text:'Не удалось выполнить запрос',type:'error','timeout':3000});});$(document).ajaxStart(function(){$('#wait').show()});$(document).ajaxStop(function(){$('#wait').delay(500).fadeOut('middle'); $('.tipsy').fadeOut('fast').remove();});$().GetContent();$('div.deltodo').live('click',function(){	var liid = $(this).parent().parent();	$.ajax({		type:'get',	url:'core.php',	data:'action=update&value=del&hash=' + liid.attr('id'),		success:function(){			liid.fadeOut(1000,function(){liid.remove(); $().UpdateInfo(); $().UpdateToday();});			noty({text:'Задача удалена',type:'success',layout:'topRight',timeout:500});		}	});});$('div.saveedit').live('click',function(){	var liid = $(this).parent().parent();	var todocontent = $(this).parent().parent().children('.todocontent');	$.ajax({		type:'get',	url:'core.php',	data:'action=updatetodo&hash='+ liid.attr('id') +'&text='+ todocontent.html(),		success: function() {			todocontent.attr({contenteditable:'false'});			todocontent.css('padding-left','10px').css('background','none');			liid.children('.todohead').children('.saveedit').css('display','none');			liid.fadeTo('fast',0.1,function(){liid.fadeTo('fast',1);});			localStorage.removeItem('edittodotext');			noty({text:'Задача изменена',type:'success',layout:'topRight',timeout:500});		}	});});$('section.todocontent').live('click',function(){	if ($(this).attr('contenteditable') != 'true') {		$(this).attr({contenteditable:'true'});		$(this).css('padding-left','35px').css('background','url(img/pencil.png) no-repeat 7px 5px');		$(this).parent().children('.todohead').children('.saveedit').show();		$(this).focus().fadeTo('fast',0.1,function(){$(this).fadeTo('fast',1);});	}	$(document).stopTime('CheckStat');});$('section.todocontent').live('keyup',function(){localStorage.setItem('edittodotext',$(this).html())});$('section.todocontent').live('blur',function(){	if ($(this).attr('contenteditable') == 'true') {		$(this).attr({contenteditable:'false'});		$(this).css('padding-left','10px').css('background','none');	}	$(document).everyTime(10000,'CheckStat',function(){$().CheckStat();}); });$('span.hiic > span.mstic').live('click',function(){	var txtstatus = {end:'В корзине',new:'Новая задача',inc:'Выполняется',end:'Выполнена',out:'Отложена',fal:'Провалена',arh:'В архиве'};	var liid = $(this).parent().parent().parent().parent();	var oldstatus = liid.attr('class').replace('todo status-','');	var newstatus = $(this).data('chstto');	$.ajax({		type:'get',	url:'core.php',	data:'action=update&value='+ newstatus +'&hash='+ liid.attr('id'),		success:function(){			if (newstatus == 'end') {liid.fadeOut(600,function(){liid.remove()})};			if (newstatus == 'fal') {liid.fadeOut(400,function(){liid.remove()})};			liid.removeClass('status-'+oldstatus).addClass('status-'+newstatus);			liid.children('.todohead').children('.mst').children('.status').html(txtstatus[newstatus]);			$().UpdateInfo(); $().UpdateToday();			noty({text:'Статус обновлён',type:'success',layout:'topRight',timeout:500});		}	});	});$('#wtdinfo').click(function(){$().UpdateInfo()});$('#today').click(function(){$().UpdateToday()});$('#overlay').click(function(){$('#user').fadeOut('fast'); $('#overlay').hide(); $('#login').attr('value',''); $('#pass').attr('value','');});$('#auth').click(function(e){e.preventDefault(); $('#overlay').show(); $('#user').PosInCenter(); $('#user').fadeIn('middle'); $('#login').focus();});$('#userloginform').submit(function(e){	e.preventDefault();	var form_method=$(this).attr('method');	var form_action=$(this).attr('action');	var form_data=$(this).serialize();	if (form_data) {		$.ajax({			type: form_method, url: form_action, data: form_data,			success: function(html){				$().GetContent();				$('#user').fadeOut('fast'); $('#overlay').hide(); $('#login').attr('value',''); $('#pass').attr('value',''); 				noty({text:html,layout:'topRight',type:'information',timeout:1000});			}		});	} else {noty({text:'Кого опознавать то?!',type:'error',timeout:1000});}});$('#todocreate').click(function(){$('#newtodo').slideDown('slow'); $('#newtodotext').focus();});$('#newtodotext').focus(function(){$(document).stopTime('CheckStat');});$('#newtodotext').blur(function(){$(document).everyTime(10000,'CheckStat',function(){ $().CheckStat();});});$('#newtodotext').keyup(function(){localStorage.setItem('newtodotext', $('#newtodotext').val());});$('#todosave').click(function(){	var todotext = $('#newtodotext').val();	if (todotext) {		$.ajax({			type:'post',	url:'core.php',	data:'action=newtodo&text='+ todotext,			success: function(html) {				$().GetContent();				$('#newtodo').slideUp('fast');				$('#newtodotext').attr('value','');				localStorage.removeItem('newtodotext');				noty({text:'Задача добавлена',layout:'topRight',type:'success',timeout:1000});			}		});	} else {noty({text:'Нечего отправлять',layout:'topRight',type:'error',timeout:1000});}});$('#todoabort').click(function() {$('#newtodo').slideUp('medium'); localStorage.removeItem('newtodotext');});$('#insertdate').click(function() {	var datepicker = $('#datepicker').attr('value'); 	var newtodotext = $('#newtodotext').attr('value'); 	$('#newtodotext').attr('value',newtodotext+' '+datepicker).focus();});$('#findbox').keyup(function() {$().initSearch();});$('#findbox').blur(function() { $('#findbox').attr('value','');	});$('#chview > li').click(function() {	var value = $(this).attr('id');	$.ajax({		type:'get',	cache:true,	url:'core.php',	data:'action=view&value=' + value.replace('view-',''),		beforeSend: function(){$('#main').hide();},		success: function(html){			$('#main').html(html);			$('#main').fadeIn(500);			noty({text:'Вид изменён',layout:'topRight',type:'information',timeout:500});		}	});});$('#cleartds > li').click(function(){if(confirm('Эту операцию нельзя отменить! Вы уверены?')){	var value = $(this).attr('id');	$.ajax({		type:'get',	url:'core.php',	data:'action=erase&value='+ value.replace('clear-',''),		success:function(){$().UpdateInfo(); $().UpdateToday(); noty({text:'Очистка завершена',layout:'topRight',type:'success',timeout:1000});}	});}});	$('#info').click(function(){$('#main').load('info.php');});$('#wtdinfo').tipsy({gravity:'e',offset:10,fade:true,delayIn:1500,delayOut:100,live:true});$('li').tipsy({gravity:'w',offset:5,fade:true,delayIn:1500,delayOut:100,live:true});$('input, textarea').tipsy({gravity:'s',offset:5,fade:true,delayIn:1500,delayOut:100,live:true});$('div.todohead > div').tipsy({gravity:'s',offset:5,fade:true,delayIn:1000,delayOut:100,live:true});$('span.hiic > span.mstic').tipsy({gravity:'s',offset:5,fade:true,delayIn:500,live:true});$('a, img').tipsy({gravity:'n',offset:3,fade:true,delayIn:500,delayOut:100,live:true});$(document).keyup(function(event){if (event.keyCode == 27) {	$('#newtodo').hide();	$('#user').hide();	$('#overlay').hide();	$('#findbox').attr('value','').blur();	$('section.todocontent').attr({contenteditable:'false'});}});$(document).everyTime(10000,'CheckStat',function(){$().CheckStat();});});